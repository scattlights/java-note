# Java 运算与类型转换题通用判断方法（四条规律）

适用于判断以下类题是否编译报错：

```java
short s = 1;
s = s + 1;   // 是否报错？
s += 1;      // 是否报错？
```

---

## ✅ 规则一：小整型做运算时会自动提升为 int

### 📘 说明
在 Java 中，`byte`、`short`、`char` 这三种小整型，只要参与运算（`+ - * /`），都会被自动提升为 `int` 类型，运算结果也是 `int`。

因此，不能直接赋值给 `short` 或 `byte` 类型变量，需要强制类型转换。

### ❌ 错误示例

```java
short s = 1;
s = s + 1; // ❌ 编译错误：s + 1 是 int，不能直接赋给 short
```

### ✅ 正确写法（强转）

```java
s = (short)(s + 1); // ✅ 正确，强制转换类型
```

---

## ✅ 规则二：复合赋值运算符会自动强制转换

### 📘 说明
使用 `+=`、`-=`、`*=`、`/=` 等复合赋值运算符时，Java 会自动帮你做类型转换。

相当于：

```java
s += 1; // 相当于：s = (short)(s + 1);
```

### ✅ 示例

```java
short s = 1;
s += 1; // ✅ 正确，不报错
```

---

## ✅ 规则三：final 常量在范围内可视为字面值

### 📘 说明
如果某个变量被 `final` 修饰，并且在编译期间值是确定的（如 `final int a = 1`），且它的值在目标类型范围内（如 `short` 范围 -32768 ~ 32767），Java 编译器会把它当作**常量字面值**处理，允许赋值给小类型。

### ✅ 示例

```java
final int a = 1;
short s = a; // ✅ 正确：a 是常量，且在 short 范围内
```

### ❌ 错误示例

```java
int a = 1;
short s = a; // ❌ 编译错误：a 不是 final，不能赋值给 short
```

---

## ✅ 规则四：只要表达式中有一个变量不是 final，就不能当常量处理

### 📘 说明
编译器只能优化**完全由 final 常量组成的表达式**。一旦表达式中某个变量不是 final，整个表达式就不是常量，不能赋值给小类型。

### ❌ 示例

```java
final int a = 1;
int b = 2;
short s = a + b; // ❌ 报错：b 不是 final，a + b 不再是常量表达式
```

### ✅ 正确写法（两个都是 final）

```java
final int a = 1;
final int b = 2;
short s = a + b; // ✅ 正确：a + b 是常量表达式，值为 3，符合 short 范围
```

---

## 📌 四条规律总结表格

| 规则编号 | 内容 | 是否允许 |
|----------|------|-----------|
| 规则一 | 小整型参与运算变 int，赋值需强转 | ❌ 报错 |
| 规则二 | 使用复合赋值符号时自动强转 | ✅ 正确 |
| 规则三 | final 常量值在范围内时允许赋值 | ✅ 正确 |
| 规则四 | 表达式中只要有一个不是 final，就不是常量表达式 | ❌ 报错 |

---

## ✅ 快速判断口诀

```
小整运算变成 int，强转回型才算稳；
复合符号自动转，不用你手忙脚乱；
final 定值编译看，常量优化才大胆。
```

---

## 🧠 再送你一条口诀加强记忆：

> 一算自动升 int，  
> 赋值必须强转；  
> 复合操作符例外，  
> final 编译期算完。
